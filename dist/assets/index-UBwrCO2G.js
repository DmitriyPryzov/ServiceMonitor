(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();function D(r,t){const e=r.value.trim().toLowerCase(),s=[];t.forEach(n=>{const a=n.textContent.toLowerCase();if(e==""){n.classList.add("hide");return}a.indexOf(e)!==-1?(n.classList.remove("hide"),s.push(n)):n.classList.add("hide")});const i=document.querySelector(".not-found");s.length>0||r.value==""?i.classList.add("hide"):s.length==0&&r.value!==""&&i.classList.remove("hide")}function L(r){if(!r)return console.error("Відсутній аргумент ID при виклику відкриття вікна");const t=document.querySelector(`[data-id='${r}']`);if(!t)return console.error("Не знайдено сторінку");t.classList.add("show-page"),t.classList.add("fade-up")}function o(r="div",...t){const e=document.createElement(r),s={string:i=>{const n=i.split(" ").filter(a=>a.trim());n.length&&e.classList.add(...n)},object:i=>{if(Array.isArray(i))e.append(...i);else if(i!==null)for(let n in i)e.setAttribute(n,i[n])}};return t.forEach(i=>{const n=typeof i;s[n]&&i!==null&&s[n](i)}),e}class S{constructor(t,e={}){this.root=document.createElement("li"),this.root.classList.add("add-client-sublist__item");const{title:s,id:i,token:n,edited:a}=this.initData(t,e);this.refs={},this.state={edited:a,title:s,id:i,token:n},this.build(),this.update(),this.onAction()}initData(t,e={}){const s={title:"",id:0,token:null,edited:!1};return!t&&t!==""?s:typeof t=="string"?{...s,title:t,...e}:typeof t=="object"&&t!==null?{title:t.Name||t.Name===""?t.Name:"Помилка",id:t.ID||0,token:t.Token||null,edited:!1,...e}:s}setState(t){this.state={...this.state,...t},this.update()}get(){return this.root}focus(){const t=this.refs.input;t.focus();const e=t.value.length;t.setSelectionRange(e,e)}onAction(){this.root.addEventListener("click",t=>{const e=t.target;e.closest(".edit")&&(this.setState({edited:!0}),this.focus()),e.closest(".remove")&&(this.event("remove"),this.root.remove())}),this.root.addEventListener("keydown",t=>{t.code==="Enter"&&(this.setState({edited:!1}),this.refs.input.blur())}),this.root.addEventListener("input",t=>{t.target==this.refs.input&&(this.state.title=t.target.value)}),this.refs.input.addEventListener("blur",()=>{this.refs.input.value?(this.setState({edited:!1}),this.refs.input.blur(),this.event("editName")):(this.event("remove"),this.root.remove())})}event(t){if(typeof t!="string")return;const{title:e,id:s}=this.state;this.root.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:{id:s,title:e}}))}update(){const{edited:t}=this.state;this.refs.input.classList.toggle("edited",t)}build(){const t=o("input","sublist__name",{value:this.state.title});this.root.append(t,o("div","add-client-events",[o("a","edit",[o("img",{src:"./assets/img/icons/edit_sim.svg",alt:"edit"})]),o("a","remove",[o("img",{src:"./assets/img/icons/delete.svg",alt:"delete"})])])),this.root.dataset.id=this.state.id,this.root.dataset.token=this.state.token,this.refs.input=t}}class T{constructor(t){this.root=document.createElement("li"),this.root.classList.add("add-client__item");const{title:e,objects:s,acc:i,id:n}=this.initData(t);this.refs={},this.state={acc:i,open:!1,title:e,id:n,edited:!1,objects:s},this.build(),this.update(),this.onAction()}initData(t){const e={title:"",id:0,objects:[],acc:!1};return t?typeof t=="string"?{...e,title:t}:typeof t=="object"&&t!==null?{title:t.Name||"Помилка",id:t.ID||0,objects:t.Objects||[],acc:!!t.Objects.length}:e:e}setState(t){this.state={...this.state,...t},this.update()}onAction(){this.root.addEventListener("click",t=>{const e=t.target,s=this.refs.input;if(e.closest(".acc-name")&&this.setState({open:!this.state.open}),e.closest(".edit-group")){this.setState({edited:!0}),s.focus();const i=s.value.length;s.setSelectionRange(i,i)}if(e.closest(".remove-group")&&(this.event("remove-client"),this.root.remove()),e.closest(".add-enterprise")){const i={ID:crypto.randomUUID(),Token:null,Name:"",EnterpriseID:this.state.id},n=new S(i,{edited:!0});this.refs.sublist.append(n.get());const a=[...this.state.objects,i];this.setState(this.state.acc?{open:!0,objects:a}:{open:!0,acc:!0,objects:a}),n.focus()}}),this.root.addEventListener("keydown",t=>{t.code==="Enter"&&(this.setState({edited:!1}),this.refs.input.blur())}),this.root.addEventListener("input",t=>{t.target==this.refs.input&&(this.state.title=t.target.value)}),this.refs.input.addEventListener("blur",()=>{this.setState({edited:!1}),this.event("change-client"),this.refs.input.blur()}),this.root.addEventListener("remove",t=>{const{id:e}=t.detail,s=this.state.objects.filter(i=>i.ID!==e);this.setState({objects:s,acc:s.length,open:s.length}),this.event("change-client")}),this.root.addEventListener("editName",t=>{const{id:e,title:s}=t.detail,i=this.state.objects.map(n=>(n.ID===e&&(n.Name=s),n));this.setState({objects:i}),this.event("change-client")})}event(t){if(typeof t!="string")return;const{title:e,id:s,objects:i}=this.state;this.root.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:{id:s,title:e,objects:i}}))}get(){return this.root}update(){const{edited:t,acc:e,open:s}=this.state;this.root.classList.toggle("acc",e),this.root.classList.toggle("open",s),this.refs.input.classList.toggle("edited",t)}renderChildren(){return this.state.objects.map(t=>new S(t).get())}build(){const t=o("input","add-client__name",{value:this.state.title}),e=o("ul","acc-sublist-content",[...this.renderChildren()]);this.root.append(o("div","block",[o("div","add-client-wrap acc-name",[t]),o("div","add-client-events",[o("a","add-enterprise",[o("img",{src:"./assets/img/icons/add.svg",alt:"add"})]),o("a","edit-group",[o("img",{src:"./assets/img/icons/edit_sim.svg",alt:"edit-group"})]),o("a","remove-group",[o("img",{src:"./assets/img/icons/delete.svg",alt:"delete"})])])]),o("div","add-client-sublist acc-sublist",[e])),this.refs.input=t,this.refs.sublist=e}}class N{constructor(t){this.root=document.querySelector(t),this.state={clients:[]},this.onAction()}setState(t){this.state={...this.state,...t}}onAction(){this.root.addEventListener("remove-client",t=>{const{id:e}=t.detail;this.setState({clients:this.state.clients.filter(s=>s.ID!==e)}),console.log(this.state.clients)}),this.root.addEventListener("change-client",t=>{const{id:e,title:s,objects:i}=t.detail,n=this.state.clients.map(a=>a.ID===e?{ID:e,Name:s,Objects:i}:a);this.setState({clients:n}),console.log(this.state.clients)})}addClients(t){const e=Array.isArray(t)?t:[t],s=document.createDocumentFragment(),i=[];return e.forEach(n=>{const a={ID:crypto.randomUUID(),Name:"",Objects:[]};let c={};typeof n=="string"&&(c={...a,Name:n}),typeof n=="object"&&(c={...a,...n}),i.push(c),s.append(new T(c).get())}),this.setState({clients:[...this.state.clients,...i]}),console.log(this.state.clients),this.root.append(s)}getData(){return this.state.clients}}class f{constructor(t){this.mainEl=this.create(t),this.elements={}}create({name:t="",tag:e="div",classes:s="",text:i="",attributes:n={},onClick:a,onInput:c}={}){const l=document.createElement(e);s&&(l.className=s),l.textContent=i,e=="input"&&(l.value=i);const g=Object.keys(n);return g&&g.forEach(b=>{l.setAttribute(b,n[b])}),a&&l.addEventListener("click",a),c&&l.addEventListener("input",c),t&&(this.elements[t]=l),l}child({name:t="",tag:e="div",classes:s="",text:i="",attributes:n={},onInput:a,onClick:c}={}){return this.mainEl.append(this.create({name:t,tag:e,classes:s,text:i,onClick:c,onInput:a,attributes:n})),this}get(t=""){return t?this.elements[t]||this.mainEl:this.mainEl}}let d=null,u=null;function _(r){const e=document.querySelector(".menu-list").querySelector(`[data-item][data-id='${r}']`),s=e.closest(".acc");if(!e)throw new Error("Не вдалось знайти вибраного клієнта в меню");d&&d!==e&&d.classList.remove("select"),u&&u!==s&&u.classList.remove("open"),e.classList.add("select"),s&&(s.classList.add("open"),u=s),d=e;const i=new CustomEvent("update-workspace",{detail:{name:e.textContent},bubbles:!0});document.dispatchEvent(i)}function A(r,t){if(!Array.isArray(t))return console.log("Аргумент не є масивом");const e=[];return t.forEach(s=>{const i=new f({tag:"li",classes:"result__item hide",attributes:{"data-id":s.ID}}).child({tag:"span",classes:"result__text",text:s.Name}).child({classes:"result__arrow"});i.get().addEventListener("click",n=>{n.target.closest(".result__item")&&(L("services"),_(s.ID))}),e.push(i.get())}),r.append(...e),e}function j(r){if(!Array.isArray(r))throw new Error("Передано невірний аргумент для побудови меню");return r.map(t=>{const e=t?.Objects&&Array.isArray(t.Objects)&&t.Objects.length>0,s=e?"acc":"",i=e?"":"data-item",n=t?.ID||"0",a=t?.Name;return`
            <li class="menu-list__item  ${s}">
                <div class="menu-list__name acc-name" data-id=${n} ${i}>${a}</div>
                <div class="menu-sublist acc-sublist">
                    <div class="acc-sublist-content">
                        ${O(t.Objects)}
                    </div>
                </div>
            </li>
        `}).join("")}function O(r){return!r||!Array.isArray(r)?"":r.map(t=>{if(!t?.Name||!t?.ID)return;const e=t.Name;return`
            <div class="menu-sublist__item" data-id="${t.ID}" data-item>${e}</div>
        `}).join("")}const C=[{IP_List:["192.168.0.1","10.10.0.25"],Services:[{Name:"Test service 1",Version:"1",StartupType:"Automatic",Status:"Running"},{Name:"Test service 2",Version:"2",StartupType:"Automatic (Delayed Start)",Status:"Stopped"},{Name:"Test service 3",Version:"3",StartupType:"Manual",Status:"Running"},{Name:"Test service 4",Version:"4",StartupType:"Automatic",Status:"Running"},{Name:"Test service 5",Version:"5",StartupType:"Automatic",Status:"Paused"}]}],h=[{ID:13,Name:"TEST",Objects:[{ID:10,Name:"TEST OBJ",Token:"i9UjC366cmRfu",EnterpriseID:13},{ID:12,Name:"Test Enterprise Object",Token:null,EnterpriseID:13},{ID:14,Name:"Extra Object 1",Token:"aB12XyZ9TqGp",EnterpriseID:13}]},{ID:16,Name:"TEST2",Objects:[]},{ID:18,Name:"Sample Enterprise",Objects:[{ID:17,Name:"Sample Object 1",Token:"kLmN34OpQrSt",EnterpriseID:18},{ID:19,Name:"Sample Object 2",Token:"UvWxYz987654",EnterpriseID:18},{ID:20,Name:"Sample Object 3",Token:null,EnterpriseID:18},{ID:21,Name:"Sample Object 4",Token:"ZxCvBnM12345",EnterpriseID:18}]},{ID:22,Name:"Another Enterprise",Objects:[{ID:23,Name:"Another Object 1",Token:"qWeRtYuIoPaS",EnterpriseID:22}]},{ID:25,Name:"Empty Enterprise",Objects:[]}];class I{constructor(){}async getAllClients(){return await new Promise((e,s)=>{e(h)})}async getServices(){return await new Promise((e,s)=>{setTimeout(()=>{const i=C[0];e(i)},1e3)})}}const y={Running:"active",Automatic:"active","Automatic (Delayed Start)":"active","Start Pending":"auto","Stop Pending":"auto","Pause Pending":"auto","Continue Pending":"auto",Manual:"auto",Stopped:"disabled",Paused:"disabled",Disabled:"disabled"};function q(r){const t=document.createElement("table");t.classList.add("main-table");const e=`
        <thead class="main-table-head">
            <tr>
                <th scope="col" class="main-table-head__item">
                    Назва служби
                </th>
                <th scope="col" class="main-table-head__item">
                    Версія
                </th>
                <th scope="col" class="main-table-head__item">
                    Стан
                </th>
                <th scope="col" class="main-table-head__item">
                    Тип запуску
                </th>
            </tr>
        </thead>
    `;let s="";r.forEach(n=>{const a=y[n.StartupType],c=y[n.Status];s+=`
            <tr class="main-table-service">
                <td class="main-table-service__item name">${n.Name}</td>
                <td class="main-table-service__item">${n.Version}</td>
                <td class="main-table-service__item">
                    <span class="state ${c}">${n.Status}</span>
                </td>
                <td class="main-table-service__item">
                    <span class="state ${a}">${n.StartupType}</span>
                </td>
            </tr>
        `});const i=`<tbody>${s}</tbody>`;return t.insertAdjacentHTML("afterbegin",e+i),t}function M(){return new f({classes:"loader",attributes:{id:"loader-points"}}).child({tag:"span"}).child({tag:"span"}).child({tag:"span"}).get()}function P(r,t="ERROR!",e=null){const s=new f({classes:"error"}).get();return s.innerHTML=`
            <div class="error-icon-block">
                <div class="error__icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                </div>
            </div>

            <div class="error-text-block">
                <h3 class="error__title">${r}</h3>
                <div class="error__desc">${t}</div>
                <button class="error__btn">Спробувати знову</button>
            </div>
    `,e&&s.querySelector(".error__btn").addEventListener("click",e),s}class ${constructor(t,e,s){this.parent=t,this.ip=e,this.clientName=s,this.clientTitle="",this.loader=M(),this.errorBlock=P,this.state={dataServices:{},loading:!1,error:!1,errorText:{}},this.serviceMonitor=new I}setState(t){this.state={...this.state,...t},this.render()}getDataServices(){return this.serviceMonitor.getServices()}appendWorkspace(t){this.parent.replaceChildren(t)}updateHeader(){const t=this.state.dataServices?.IP_List?.join(", ")||"";this.ip&&(this.ip.textContent=t),this.clientName&&(this.clientName.innerText=this.clientTitle)}async updateWorkspace(t=""){t&&(this.clientTitle=t),this.setState({loading:!0});try{const e=await this.getDataServices();this.setState({loading:!1,dataServices:e})}catch(e){this.setState({error:!0,loading:!1,errorText:{title:"Помилка отримання даних",desc:e}})}}render(){if(this.state.loading){this.appendWorkspace(this.loader);return}if(this.state.error){this.appendWorkspace(this.errorBlock(this.state.errorText.title,this.state.errorText.desc,this.updateWorkspace.bind(this)));return}const t=this.state.dataServices.Services;if(!t||t.length===0){this.appendWorkspace(this.errorBlock("Не знайдено жодної служби","Служба ServiceMonitor не повернула жодного результату",this.updateWorkspace.bind(this)));return}const e=q(this.state.dataServices.Services);this.appendWorkspace(e),this.updateHeader()}}function w(r,t){if(!Array.isArray(t)||!t.length)return[];let e=[];for(let s of t){const i=s?.Name?s.Name:"";if(!i)return;if(i.toLowerCase().includes(r.toLowerCase()))e.push(s);else{const n=s?.Objects?s.Objects:null;if(n){const a=w(r,n);e=e.concat(a)}}}return e}const m=document.querySelector(".hero__input"),x=document.querySelector(".result"),v=document.querySelector(".menu-list"),B=document.querySelector(".add-client-page"),p=document.querySelector("#add-input"),R=document.querySelector("#add-btn"),W=document.querySelector(".workspace-body"),F=new I,H=new $(W,document.querySelector(".workspace__ip"),document.querySelector(".workspace__client"));document.addEventListener("update-workspace",r=>{const{name:t}=r.detail;H.updateWorkspace(t)});const k=new N(".add-client-list");k.addClients(h);v.insertAdjacentHTML("afterbegin",j(h));v.addEventListener("click",r=>{const t=r.target,e=t.closest("[data-item]");e&&_(e.dataset.id),t.closest(".menu-list__name")&&!t.closest("[data-item]")&&t.closest(".acc").classList.toggle("open")});const U=await F.getAllClients(),V=A(x,Z(U));B.addEventListener("click",()=>L("add-client"));document.addEventListener("click",r=>{const t=r.target;if(t.closest(".back-btn")){const e=t.closest(".page");e.classList.add("hide-page"),e.classList.remove("fade-up"),setTimeout(()=>{e.classList.remove("show-page"),e.classList.remove("hide-page")},1e3)}});m.focus();m.addEventListener("input",()=>{D(m,V)});R.addEventListener("click",()=>{p.value&&(k.addClients(p.value.trim()),p.value="")});function Z(r){const t=[];return r.forEach(e=>{if(!(!e?.Objects||!e?.Name))return e.Objects.length>0?t.push(...e.Objects):t.push(e)}),t}const E=document.querySelector(".menu__find");E.addEventListener("input",()=>{v.innerHTML=j(w(E.value,h))});
